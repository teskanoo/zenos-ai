script:
  zen_dojotools_event_emitter:
    alias: Zen DojoTools Event Emitter
    description: >
      Zen DojoTools Event Emitter (v1.2.0 RC1). Advanced mode for Zen!
    
      Emits structured ZenOS-AI events or returns a dictionary of canonical event
      shapes. Used for breadcrumbs, observability, and trace reconstruction by Zen
      Connstructs and the Monastery.
    
      Modes:
        emit → send a zen_event to the HA EventBus
        help → return well-known event templates (Zen Event Lexicon)
    
      Fields:
        timestamp, component, severity, kind, summary, metadata, kata, monk.
    
      Payloads must remain small; avoid logs or large arrays. This tool never alters
      system state—only emits events or returns definitions.
    fields:
      mode:
        selector:
          select:
            options:
              - emit
              - help
        default: emit
        description: |
          Operation mode. emit = send event. help = return canonical event shapes.
      component:
        selector:
          text:
        required: true
        description: >
          REQUIRED. Subsystem generating the event. Example: "friday", "monastery",
          "filecabinet", "room_manager", "warden".
      severity:
        selector:
          select:
            options:
              - debug
              - info
              - warn
              - error
        default: info
        description: |
          Severity of this event.
      kind:
        selector:
          text:
        required: true
        description: >
          REQUIRED. Event classifier. Examples: "summary", "summary_force",
          "kata_emit", "heartbeat".
      summary:
        selector:
          text:
        required: true
        description: |
          REQUIRED. Human-readable summary (1–2 sentences).
      metadata:
        selector:
          object:
        default: {}
        description: |
          OPTIONAL. Small structured details (no logs or large arrays).
      kata:
        selector:
          object:
        default: {}
        description: |
          OPTIONAL. Tiny kata snapshot.
      monk:
        selector:
          object:
        default: {}
        description: |
          OPTIONAL. Miniature reasoning breadcrumb.
    mode: parallel
    sequence:
      - choose:
          - conditions:
              - condition: template
                value_template: "{{ mode == 'help' }}"
            sequence:
              - variables:
                  well_known_events:
                    summary_force:
                      component: any
                      kind: summary_force
                      severity: info
                      summary: Forcing immediate Zen summary of (Kung fu component id)
                      metadata:
                        force: summary
                      kata: {}
                      monk: {}
              - stop: done
                response_variable: well_known_events
      - variables:
          ts: "{{ now().isoformat() }}"
          evt:
            timestamp: "{{ ts }}"
            component: "{{ component }}"
            severity: "{{ severity }}"
            kind: "{{ kind }}"
            summary: "{{ summary }}"
            metadata: "{{ metadata | default({}) }}"
            kata: "{{ kata | default({}) }}"
            monk: "{{ monk | default({}) }}"
      - event: zen_event
        event_data:
          event: "{{ evt }}"
      - data:
          message: >
            zen_event {{ evt.component }} | {{ evt.kind }} | {{ evt.severity }} |
            summary="{{ evt.summary }}" | meta={{ evt.metadata | to_json }}
          level: "{{ severity }}"
        action: system_log.write
      - variables:
          final:
            status: success
            message: Zen event emitted
            event: "{{ evt }}"
      - stop: done
        response_variable: final
